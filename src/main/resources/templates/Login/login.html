<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TechFix - Iniciar Sesión</title>
	<link rel="stylesheet" th:href="@{/assets/css/login-css.css}">
</head>

<body>
	<div class="login-container">
		<div class="login-header">
			<h1>TechFix</h1>
			<p>Inicia sesión en tu cuenta</p>
		</div>

		<form class="login-form" id="loginForm" th:action="@{/usuarios/login}" method="post">
			<!-- CSRF Token (OBLIGATORIO con Spring Security) -->
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

			<!-- Mensajes de Spring Security -->
			<div class="alert-message error" th:if="${param.error}">
				<span class="icon">❌</span>
				<span class="text">Email o contraseña incorrectos</span>
			</div>

			<div class="alert-message success" th:if="${param.logout}">
				<span class="icon">✅</span>
				<span class="text">Has cerrado sesión exitosamente</span>
			</div>

			<div class="alert-message success" th:if="${param.registered}">
				<span class="icon">✅</span>
				<span class="text">¡Registro exitoso! Ahora puedes iniciar sesión</span>
			</div>

			<!-- Mensajes flash del controlador -->
			<div class="alert-message error" th:if="${error}">
				<span class="icon">❌</span>
				<span class="text" th:text="${error}"></span>
			</div>

			<div class="alert-message success" th:if="${success}">
				<span class="icon">✅</span>
				<span class="text" th:text="${success}"></span>
			</div>

			<div class="form-group">
				<label for="username">Correo Electrónico</label>
				<!-- IMPORTANTE: Spring Security usa 'username' para el email -->
				<input type="email" id="username" name="username" placeholder="tu@email.com" required
					autocomplete="email" th:value="${param.email != null} ? ${param.email} : ''">
			</div>

			<div class="form-group">
				<label for="password">Contraseña</label>
				<input type="password" id="password" name="password" placeholder="••••••••" required
					autocomplete="current-password">
			</div>

			<button type="submit" class="login-button" id="loginButton">
				<span class="button-text">Iniciar Sesión</span>
				<span class="loading-spinner" style="display: none;">⏳</span>
			</button>

			<div class="divider">
				<span>o</span>
			</div>

			<div class="register-link">
				<p>¿No tienes una cuenta?</p>
				<a th:href="@{/usuarios/registro}" class="register-button">
					Regístrate aquí
				</a>
			</div>

			<div class="back-home">
				<a th:href="@{/}" class="back-link">
					← Volver al inicio
				</a>
			</div>
		</form>
	</div>
	<script th:src="@{/assets/js/login-js.js}"></script>
</body>

</html>